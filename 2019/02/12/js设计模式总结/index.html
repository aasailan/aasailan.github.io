<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.2 -->
    <script>
        window.materialVersion = "1.5.2"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">














    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            js设计模式总结 | 
        
        aasailan的blog
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="aasailan的blog">
    <meta name="keywords" content=",前端,javascript,设计模式">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?MKetZV3cUTfDxvMffaOezg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #3F3F3F;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?ezyEvm8ST5CGfpA+kFFi1g==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="aasailan的blog">
    <meta name="msapplication-starturl" content="http://yoursite.com/2019/02/12/js设计模式总结/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="aasailan的blog">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://yoursite.com/2019/02/12/js设计模式总结/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="js设计模式总结 | aasailan的blog">
    <meta property="og:image" content="/img/favicon.png">
    <meta property="og:description" content="aasailan的blog">
    <meta property="og:article:tag" content="前端"> <meta property="og:article:tag" content="javascript"> <meta property="og:article:tag" content="设计模式"> 

    
        <meta property="article:published_time" content="Tue Feb 12 2019 10:06:52 GMT+0800">
        <meta property="article:modified_time" content="Fri Feb 15 2019 11:47:29 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://yoursite.com/2019/02/12/js设计模式总结/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://yoursite.com/2019/02/12/js设计模式总结/index.html",
    "headline": "js设计模式总结",
    "datePublished": "Tue Feb 12 2019 10:06:52 GMT+0800",
    "dateModified": "Fri Feb 15 2019 11:47:29 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "aasailan",
        "image": {
            "@type": "ImageObject",
            "url": "/img/touxiang.jpg"
        },
        "description": "程序员是一个值得自豪的职业"
    },
    "publisher": {
        "@type": "Organization",
        "name": "aasailan的blog",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",前端,javascript,设计模式",
    "description": "aasailan的blog",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span id="MD-burger-id" class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#设计模式概要"><span class="post-toc-number">1.</span> <span class="post-toc-text">设计模式概要</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#什么是设计模式："><span class="post-toc-number">1.1.</span> <span class="post-toc-text">什么是设计模式：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#设计模式的好处："><span class="post-toc-number">1.2.</span> <span class="post-toc-text">设计模式的好处：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#设计模式的由来"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">设计模式的由来</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#设计模式在不同语言中的区别"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">设计模式在不同语言中的区别</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#分辨模式的关键在于意图而不是结构"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">分辨模式的关键在于意图而不是结构</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#本文参考资料概要"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">本文参考资料概要</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#js设计模式总结"><span class="post-toc-number">2.</span> <span class="post-toc-text">js设计模式总结</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#创建型设计模式"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">创建型设计模式</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#工厂模式（Factory）"><span class="post-toc-number">2.1.1.</span> <span class="post-toc-text">工厂模式（Factory）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#抽象工厂（Abstract-Factory）"><span class="post-toc-number">2.1.2.</span> <span class="post-toc-text">抽象工厂（Abstract Factory）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#原型模式（prototype）"><span class="post-toc-number">2.1.3.</span> <span class="post-toc-text">原型模式（prototype）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#单例模式（singleton）"><span class="post-toc-number">2.1.4.</span> <span class="post-toc-text">单例模式（singleton）</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#结构型设计模式（Structural）"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">结构型设计模式（Structural）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#外观模式（facade）"><span class="post-toc-number">2.2.1.</span> <span class="post-toc-text">外观模式（facade）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#享元模式（Flyweight）"><span class="post-toc-number">2.2.2.</span> <span class="post-toc-text">享元模式（Flyweight）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#装饰器模式（decorator）"><span class="post-toc-number">2.2.3.</span> <span class="post-toc-text">装饰器模式（decorator）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#代理模式"><span class="post-toc-number">2.2.4.</span> <span class="post-toc-text">代理模式</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#组合模式"><span class="post-toc-number">2.2.5.</span> <span class="post-toc-text">组合模式</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#行为型设计模式（Behavioral）"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">行为型设计模式（Behavioral）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#观察者模式（Observe）"><span class="post-toc-number">2.3.1.</span> <span class="post-toc-text">观察者模式（Observe）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#发布订阅模式（Publish-Subscribe）"><span class="post-toc-number">2.3.1.1.</span> <span class="post-toc-text">发布订阅模式（Publish/Subscribe）</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#中介者模式"><span class="post-toc-number">2.3.2.</span> <span class="post-toc-text">中介者模式</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#状态模式（state）"><span class="post-toc-number">2.3.3.</span> <span class="post-toc-text">状态模式（state）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#策略模式（strategy）"><span class="post-toc-number">2.3.4.</span> <span class="post-toc-text">策略模式（strategy）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#职责链模式（Chain-of-Responsibility）"><span class="post-toc-number">2.3.5.</span> <span class="post-toc-text">职责链模式（Chain of  Responsibility）</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#后话"><span class="post-toc-number">3.</span> <span class="post-toc-text">后话</span></a></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                js设计模式总结
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/touxiang.jpg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>aasailan</strong>
        <span>2月 12, 2019</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/javascript/">javascript</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/前端/">前端</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/设计模式/">设计模式</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    

    <!-- Share Twitter -->
    

    <!-- Share Facebook -->
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <!-- post7 -->
<h1 id="设计模式概要"><a href="#设计模式概要" class="headerlink" title="设计模式概要"></a>设计模式概要</h1><h2 id="什么是设计模式："><a href="#什么是设计模式：" class="headerlink" title="什么是设计模式："></a>什么是设计模式：</h2><p>A pattern is a <strong>reusable solution</strong> that can be applied to commonly occurring problems <strong>in software design</strong>.  Another way of looking at pattern are as templates for how we solve problems - ones which can be used in quite a few different situations.    </p>
<h2 id="设计模式的好处："><a href="#设计模式的好处：" class="headerlink" title="设计模式的好处："></a>设计模式的好处：</h2><ol>
<li>pattern are proven solutions（设计模式是被证明过的解决方案）: They provide solid approaches to solving issues in software development using proven techniques that reflect the experience and insights the developers that helped define them bring to the paern. </li>
<li>pattern can be easily reused（设计模式易被重复使用）: A paern usually reflects an out of the box solution that can be adapted to suit our own needs. This feature makes them quite robust. </li>
<li>pattern can be expressive（设计模式富有表现力）: When we look at a paern there’s generally a set structure and vocabulary to the solution presented that can help express rather large solutions quite elegantly. </li>
</ol>
<h2 id="设计模式的由来"><a href="#设计模式的由来" class="headerlink" title="设计模式的由来"></a>设计模式的由来</h2><p>最早的时候有一位叫 Christopher Alexander.的建筑师，总结了自己在建筑领域的一些经验并且出版了相关的出版物，这些经验在建筑领域起到了很好的效果。<br>后来一些软件工程师汲取了 Alexander的经验，把一些设计模式写到文件中作为开发者们提升编程技巧的指导，设计模式这个概念开始在编程领域流行。<br>1995年，Erich Gamma, Richard Helm, Ralph Johnson and John Vlissides 这四个人出版了著名的书籍: Design pattern: Elements Of Reusable Object-Oriented Software 。 这四个人被称为 Gang of Four (or GoF for short).<br>这本书中提出了23种面向对象的设计模式，并且对这23中设计模式做了分类：   </p>
<ul>
<li>创建型设计模式（Creational）：以创建对象为目标的设计模式<ul>
<li>工厂模式（factory）</li>
<li>抽象工厂模式（Abstract Factory）</li>
<li>建造者模式（builder）</li>
<li>原型模式（prototype）</li>
<li>单例模式（singleton）</li>
</ul>
</li>
<li>结构型设计模式（Structural）：关注对象之间的组合结构<ul>
<li>适配器模式（adapter）</li>
<li>桥接模式（Bridge）</li>
<li>组合模式（Composite）</li>
<li>外观模式（Facade）</li>
<li>享元模式（Flyweight）</li>
<li>代理模式（proxy）</li>
<li>装饰器模式（decorator）</li>
</ul>
</li>
<li>行为型设计模式（Behavioral）：提高系统内相互独立的对象之间的交流通讯<ul>
<li>解释器模式（Interpreter）</li>
<li>模板方法模式（template method）</li>
<li>职责链模式（Chain of  Responsibility ）</li>
<li>命令模式（Command）</li>
<li>迭代器模式（Iterator）</li>
<li>中介者模式（Mediator）</li>
<li>备忘录模式（Memento）</li>
<li>观察者模式（Observer）</li>
<li>状态模式（state）</li>
<li>策略模式（strategy）</li>
<li>访问者模式（visitor）</li>
</ul>
</li>
</ul>
<h2 id="设计模式在不同语言中的区别"><a href="#设计模式在不同语言中的区别" class="headerlink" title="设计模式在不同语言中的区别"></a>设计模式在不同语言中的区别</h2><p>Design pattern 这本书大部分代码由C++写成，其讲述的也是基于静态类型语言的设计模式。在C++，java等静态语言中，函数作为逻辑运算代码块无法单独传递，只能依附于某一个对象，作为该对象的方法进行传递，因此在这些静态语言中面向对象编程几乎成为必然。Design pattern 这本书完全是从<strong>面相对象设计</strong>的角度出发，通过对封装、继承、多态、组合等技术的反复使用，提炼出一些<strong>可重复使用的面向对象的设计技巧</strong>。<br>在js等动态语言中，有两个特性与静态语言显著不同：1、js中函数是一等公民，可以直接传递函数引用而无需依附在某个对象。2、js中可以动态修改对象。这两个明显不同导致Gof提出的一些设计模式在动态语言中出现了变种或者大相径庭的实现方式。比如Command模式在java中通常需要一个命令类、一个接受类、一个调用者类，逻辑运算函数依附在命令类对象中四处传递。然而在js中可以直接传递函数引用，这导致命令类成为非必要的存在，因为只要传递函数就可以了。</p>
<h2 id="分辨模式的关键在于意图而不是结构"><a href="#分辨模式的关键在于意图而不是结构" class="headerlink" title="分辨模式的关键在于意图而不是结构"></a>分辨模式的关键在于意图而不是结构</h2><p>设计模式中有一些设计模式的代码结构粗看起来几乎一模一样，让人分不清有啥区别，实际上这是普遍情况。辨别模式的关键是这个模式出现的场景，以及为我们解决了什么问题。</p>
<h2 id="本文参考资料概要"><a href="#本文参考资料概要" class="headerlink" title="本文参考资料概要"></a>本文参考资料概要</h2><p>本人主要阅读了三本关于js设计模式的书籍，这篇文章是对三本书做出的截取和总结，本文中许多文字和例子截取自这三本书籍，并且加上一些个人理解和总结。以下是本人对三本书籍优缺点的一些总结：</p>
<ul>
<li>Learning JavaScript Design pattern：Addy Osmani 编写，本书讲述清晰简短，比较权威，由于设计模式在网上相关的文章太多，杂乱无章，因此本文尽量以这本英文原版书籍为主。本书已经在github上开源，非常值得一读。仓库地址：<a href="https://github.com/addyosmani/essential-js-design-patterns" target="_blank" rel="noopener">https://github.com/addyosmani/essential-js-design-patterns</a> </li>
<li>javascript设计模式：张容铭著，这本书讲述简短，适合入门和快速阅读。但是其中一些设计模式的例子编写得并不好，并且书中强行使用java的思维写js，使得一些例子看起来非常牵强，容易让人对一些设计模式产生误解。</li>
<li>javascript设计模式与开发实践：曾探著，这本书讲解深刻，讲解了一些设计模式在js和其他静态语言中的区别，给出的代码示例比较贴合，但是因为讲解详细，篇幅较长，适合细读。</li>
</ul>
<h1 id="js设计模式总结"><a href="#js设计模式总结" class="headerlink" title="js设计模式总结"></a>js设计模式总结</h1><p>以下是本人看完三本书后，对一些js设计模式的总结和理解</p>
<h2 id="创建型设计模式"><a href="#创建型设计模式" class="headerlink" title="创建型设计模式"></a>创建型设计模式</h2><p>Creational design pattern focus on handling object creation mechanisms where objects are created in a manner suitable for the situation we’re working in. The basic approach to object creation might otherwise lead to added complexity in a project whilst these pattern aim to solve this problem by controlling the creation process.<br>创建型设计模式关注于如何在恰当的环境下以恰当的方式生成所需要的对象。一些创建对象的基本方式（例如直接使用new + constructor，这种创建方式会在系统中到处存在，而当某个constructor需要改动时，需要修改系统内所有使用了这个constructor的地方）可能会增加系统的复杂度。创建型设计模式也可以解决这类问题。</p>
<h3 id="工厂模式（Factory）"><a href="#工厂模式（Factory）" class="headerlink" title="工厂模式（Factory）"></a>工厂模式（Factory）</h3><p>工厂模式：工厂模式就是利用一个工厂对象（方法），来生成需要的对象，避免了直接使用new+构造函数的方式来生成对象，同时工厂方法生成目标对象的过程可以自由控制，来按需生成对象。</p>
<p>特点：</p>
<ul>
<li>目的是为了生成对象</li>
<li>控制生成过程，按需生成</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Car</span>(<span class="params"> options </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.doors = options.doors || <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">this</span>.state = options.state || <span class="string">"brand new"</span>;</span><br><span class="line">  <span class="keyword">this</span>.color = options.color || <span class="string">"silver"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Truck</span>(<span class="params"> options</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.state = options.state || <span class="string">"used"</span>;</span><br><span class="line">  <span class="keyword">this</span>.wheelSize = options.wheelSize || <span class="string">"large"</span>;</span><br><span class="line">  <span class="keyword">this</span>.color = options.color || <span class="string">"blue"</span>;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line"><span class="comment">// 工厂类</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">VehicleFactory</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="comment">// Our default vehicleClass is Car</span></span><br><span class="line">VehicleFactory.prototype.vehicleClass = Car;</span><br><span class="line"><span class="comment">// 工厂类工厂方法</span></span><br><span class="line">VehicleFactory.prototype.createVehicle = <span class="function"><span class="keyword">function</span> (<span class="params"> options </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span>(options.vehicleType)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"car"</span>:</span><br><span class="line">      <span class="keyword">this</span>.vehicleClass = Car;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"truck"</span>:</span><br><span class="line">      <span class="keyword">this</span>.vehicleClass = Truck;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">this</span>.vehicleClass( options ); </span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> carFactory = <span class="keyword">new</span> VehicleFactory();</span><br><span class="line"><span class="keyword">var</span> car = carFactory.createVehicle(&#123;</span><br><span class="line">  vehicleType: <span class="string">"car"</span>,</span><br><span class="line">  color: <span class="string">"yellow"</span>,</span><br><span class="line">  doors: <span class="number">6</span> </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log( car <span class="keyword">instanceof</span> Car ); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log( car );</span><br></pre></td></tr></table></figure>
<h3 id="抽象工厂（Abstract-Factory）"><a href="#抽象工厂（Abstract-Factory）" class="headerlink" title="抽象工厂（Abstract Factory）"></a>抽象工厂（Abstract Factory）</h3><p>抽象工厂：抽象工厂依然是工厂模式的样子，只是它与它所创建的对象更加<strong>解耦</strong>。当一个系统与它所创建对象的创建方式是隔离的，或者这个系统需要创建许多不同类型的对象，这个时候可以考虑抽象工厂。抽象工厂在生成时并不清楚它能产生哪些对象，只是用一组规则描述它能产生哪些类型的对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成抽象工厂函数，此时抽象工厂不清楚自己能生成哪些对象</span></span><br><span class="line"><span class="keyword">var</span> abstractVehicleFactory = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> types = &#123;&#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    getVehicle: <span class="function"><span class="keyword">function</span> (<span class="params"> type, customizations </span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> Vehicle = types[type];</span><br><span class="line">      <span class="keyword">return</span> (Vehicle ? <span class="keyword">new</span> Vehicle(customizations) : <span class="literal">null</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态注册生成对象</span></span><br><span class="line">    registerVehicle: <span class="function"><span class="keyword">function</span> (<span class="params"> type, Vehicle </span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> proto = Vehicle.prototype;</span><br><span class="line">      <span class="comment">// 用一组规则描述它能产生哪些类型的对象</span></span><br><span class="line">      <span class="keyword">if</span> ( proto.drive &amp;&amp; proto.breakDown ) &#123;</span><br><span class="line">          types[type] = Vehicle;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> abstractVehicleFactory;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动态注册，Car， Truck类的定义省略不写...</span></span><br><span class="line">abstractVehicleFactory.registerVehicle( <span class="string">"car"</span>, Car );</span><br><span class="line">abstractVehicleFactory.registerVehicle( <span class="string">"truck"</span>, Truck );</span><br><span class="line">   </span><br><span class="line"><span class="comment">// 生成对象</span></span><br><span class="line"><span class="keyword">var</span> car = abstractVehicleFactory.getVehicle( <span class="string">"car"</span>, &#123;</span><br><span class="line">  color: <span class="string">"lime green"</span>,</span><br><span class="line">  state: <span class="string">"like new"</span> </span><br><span class="line">&#125;);</span><br><span class="line">   </span><br><span class="line"><span class="comment">// 生成对象</span></span><br><span class="line"><span class="keyword">var</span> truck = abstractVehicleFactory.getVehicle( <span class="string">"truck"</span>, &#123;</span><br><span class="line">  wheelSize: <span class="string">"medium"</span>,</span><br><span class="line">  color: <span class="string">"neon yellow"</span> </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(car <span class="keyword">instanceof</span> Car); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(truck <span class="keyword">instanceof</span> Truck) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h3 id="原型模式（prototype）"><a href="#原型模式（prototype）" class="headerlink" title="原型模式（prototype）"></a>原型模式（prototype）</h3><p>GoF 提出的原型模式本是指将一个已经存在的object作为模板，通过clone的手段来生成一个新的对象。参照java的实现会更加清晰（<a href="http://www.runoob.com/design-pattern/prototype-pattern.html" target="_blank" rel="noopener">http://www.runoob.com/design-pattern/prototype-pattern.html</a><br>）。在js中，原型模式发生了转变，泛指通过修改对象的__proto__ 属性或者修改构造函数的prototype属性，来达成clone属性与方法的目的，这与js原型继承或者mixin的概念本质是差不多的。</p>
<p>示例1：通过修改对象的<strong>proto</strong> 属性来clone属性与方法<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义 模板对象</span></span><br><span class="line"><span class="keyword">var</span> myCar = &#123;</span><br><span class="line">  name: <span class="string">"Ford Escort"</span>,</span><br><span class="line"> </span><br><span class="line">  drive: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">"Weeee. I'm driving!"</span> );</span><br><span class="line">  &#125;,</span><br><span class="line"> </span><br><span class="line">  panic: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">"Wait. How do you stop this thing?"</span> );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 创建target对象，通过修改target对象的__proto__ 属性来clone模板对象的属性与方法</span></span><br><span class="line"><span class="keyword">var</span> yourCar = <span class="built_in">Object</span>.create( myCar );</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log( yourCar.name ); <span class="comment">// Ford Escort</span></span><br></pre></td></tr></table></figure></p>
<p>示例2：通过修改构造函数的prototype属性来clone属性与方法<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义模板对象</span></span><br><span class="line"><span class="keyword">var</span> vehiclePrototype = &#123;</span><br><span class="line">  init: <span class="function"><span class="keyword">function</span> (<span class="params"> carModel </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.model = carModel;</span><br><span class="line">  &#125;,</span><br><span class="line">  getModel: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">"The model of this vehicle is.."</span> + <span class="keyword">this</span>.model);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义对象生成方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">vehicle</span>(<span class="params"> model </span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">  <span class="comment">// 修改构造函数prototype属性，实现对模板对象的方法的clone（与继承本质一样）</span></span><br><span class="line">  F.prototype = vehiclePrototype;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> f = <span class="keyword">new</span> F();</span><br><span class="line">  f.init( model );</span><br><span class="line">  <span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> car = vehicle( <span class="string">"Ford Escort"</span> );</span><br><span class="line">car.getModel(); <span class="comment">// The model of this vehicle is..Ford Escort</span></span><br></pre></td></tr></table></figure></p>
<h3 id="单例模式（singleton）"><a href="#单例模式（singleton）" class="headerlink" title="单例模式（singleton）"></a>单例模式（singleton）</h3><p>单例模式是指严格约束一个类只有一个实例对象。一个典型的单例模式可以这样实现，通过一个方法来生成单例对象，当该对象不存在时，生成对象并返回，当对象存在时，直接返回对象。<br>js中，单例模式通常与namespace的实现联系在一起，利用namespace来为单例对象提供一个全局统一的获取入口，而单例对象作为一个闭包对象存储在namespace中。<br>js中的单例模式通常还伴随着lazy generate的概念，即只在首次获取时产生单例对象，否则不产生。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义 mySingleton namespace (namespace在js中通常由一个对象实现)</span></span><br><span class="line"><span class="keyword">var</span> mySingleton = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">var</span> instance;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 单例对象生成方法</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 私有属性</span></span><br><span class="line">    <span class="keyword">var</span> privateRandomNumber = <span class="built_in">Math</span>.random();</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// Public methods and variables</span></span><br><span class="line">      publicMethod: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log( <span class="string">"The public can see me!"</span> );</span><br><span class="line">      &#125;,</span><br><span class="line">  </span><br><span class="line">      publicProperty: <span class="string">"I am also public"</span>,</span><br><span class="line">  </span><br><span class="line">      getRandomNumber: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> privateRandomNumber;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  </span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    getInstance: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// lazy generate</span></span><br><span class="line">      <span class="keyword">if</span> ( !instance ) &#123;</span><br><span class="line">        instance = init();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> singleA = mySingleton.getInstance();</span><br><span class="line"><span class="keyword">var</span> singleB = mySingleton.getInstance();</span><br><span class="line"><span class="built_in">console</span>.log( singleA.getRandomNumber() === singleB.getRandomNumber() ); <span class="comment">// true</span></span><br></pre></td></tr></table></figure></p>
<h2 id="结构型设计模式（Structural）"><a href="#结构型设计模式（Structural）" class="headerlink" title="结构型设计模式（Structural）"></a>结构型设计模式（Structural）</h2><p>Structural pattern are concerned with object composition and typically identify simple ways to realize relationships between different objects. They help ensure that when one part of a system changes, the entire structure of the system doesn’t need to do the same. They also assist in recasting parts of the system which don’t fit a particular purpose into those that do.<br>结构型设计模式主要关注对象之间的组合结构。结构型设计模式使得当系统中的一部分发生改变时，整个系统不需要有大的改动。</p>
<h3 id="外观模式（facade）"><a href="#外观模式（facade）" class="headerlink" title="外观模式（facade）"></a>外观模式（facade）</h3><p>外观模式是将底层方法封装，向上提供简单明了的接口，隐藏自身内部的复杂性。比较典型的例子是JQuery封装的一系列dom操作api，内部隐藏了不同浏览器适配的逻辑，只向用户提供统一的简单的api操作。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用外观模式封装注册监听函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addMyEvent</span>(<span class="params">el, ev, fn</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( el.addEventListener )&#123;</span><br><span class="line">    el.addEventListener( ev,fn, <span class="literal">false</span> );</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(el.attachEvent)&#123;</span><br><span class="line">    el.attachEvent( <span class="string">"on"</span> + ev, fn );</span><br><span class="line">  &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    el[<span class="string">"on"</span> + ev] = fn;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// JQuery的方法 $(el)、 $(el).css()等等</span></span><br></pre></td></tr></table></figure></p>
<h3 id="享元模式（Flyweight）"><a href="#享元模式（Flyweight）" class="headerlink" title="享元模式（Flyweight）"></a>享元模式（Flyweight）</h3><p>享元模式是通过共享复用的数据结构或对象，来达到节省应用内存，提升应用效率的目的。<br>享元模式在js中主要有两个方面的应用：</p>
<ol>
<li>数据层面：通过共享数据对象来节约内存</li>
<li>dom层面：复用dom元素或者使用事件委托模型（在容器上注册监听事件，然后分发给子元素，避免所有子元素都注册监听事件）</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"container"</span>&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"toggle"</span> href=<span class="string">"#"</span>&gt;More Info (Address)</span><br><span class="line">    &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"info"</span>&gt;</span><br><span class="line">      This is more information</span><br><span class="line">    &lt;<span class="regexp">/span&gt;&lt;/</span>div&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"toggle"</span> href=<span class="string">"#"</span>&gt;Even More Info (<span class="built_in">Map</span>)</span><br><span class="line">    &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"info"</span>&gt;</span><br><span class="line">      &lt;iframe src=<span class="string">"..."</span>&gt;&lt;/iframe&gt;</span><br><span class="line">    &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="comment">/********************** Snippet 2 **********************/</span><span class="regexp">/</span></span><br><span class="line"><span class="regexp">var stateManager = &#123;</span></span><br><span class="line"><span class="regexp">  fly: function () &#123;</span></span><br><span class="line"><span class="regexp">    var self = this;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ 事件委托，在容器上进行监听，避免多个相同的监听浪费内存</span></span><br><span class="line"><span class="regexp">    $( "#container" )</span></span><br><span class="line"><span class="regexp">    .unbind()</span></span><br><span class="line"><span class="regexp">    .on( "click", "div.toggle", function ( e ) &#123;</span></span><br><span class="line"><span class="regexp">      self.handleClick( e.target );</span></span><br><span class="line"><span class="regexp">    &#125;);</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">  </span></span><br><span class="line"><span class="regexp">  handleClick: function (elem) &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ 复用dom元素，避免重新创建DOM对象</span></span><br><span class="line"><span class="regexp">    $(elem).find( "span" ).toggle( "slow" );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure>
<h3 id="装饰器模式（decorator）"><a href="#装饰器模式（decorator）" class="headerlink" title="装饰器模式（decorator）"></a>装饰器模式（decorator）</h3><p>传统定义中，装饰器模式是指能在一个系统中动态地为已存在的class添加新的行为。利用这种方式可以在不需要大量改造旧代码的情况下，为系统添加新的功能。这里有两个关键点：</p>
<ol>
<li>不改变原有对象（类）的结构的前提下</li>
<li>添加新的功能（行为）  </li>
</ol>
<p>得益于js是一门动态语言，装饰器模式在js中可以有两种实现方式  </p>
<ol>
<li>类似于静态语言，创建一个装饰器对象或者装饰器函数作为代理，去调用<strong>被装饰对象</strong>的方法，然后在代理中添加额外的新功能。</li>
<li>直接把新功能函数赋值给被装饰对象的同名属性，把旧函数替换掉，而新函数中包含了旧函数的调用以及添加的新功能逻辑</li>
</ol>
<p>实现方式一：通过调用装饰器函数作为代理，来调用被装饰对象的方法，这种方式与代理模式非常类似<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MacBook</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.cost = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="number">997</span>; &#125;;</span><br><span class="line">  <span class="keyword">this</span>.screenSize = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="number">11.6</span>; &#125;;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line"><span class="comment">// Decorator 1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">memory</span>(<span class="params"> macbook </span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 装饰器函数内保留被装饰对象方法的功能</span></span><br><span class="line">  <span class="keyword">var</span> v = macbook.cost();</span><br><span class="line">  <span class="comment">// 新增功能</span></span><br><span class="line">  macbook.cost = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> v + <span class="number">75</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Decorator 2</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">engraving</span>(<span class="params"> macbook </span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> v = macbook.cost();</span><br><span class="line">  macbook.cost = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> v + <span class="number">200</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line"><span class="comment">// Decorator 3</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">insurance</span>(<span class="params"> macbook </span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> v = macbook.cost();</span><br><span class="line">  macbook.cost = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> v + <span class="number">250</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line"><span class="keyword">var</span> mb = <span class="keyword">new</span> MacBook();</span><br><span class="line"><span class="comment">// 调用装饰器函数，这样就不用修改MacBook类，来达到新增功能的目的</span></span><br><span class="line">memory( mb );</span><br><span class="line">engraving( mb );</span><br><span class="line">insurance( mb );</span><br></pre></td></tr></table></figure></p>
<p>实现方式2：由于js可以动态修改对象，所以可以直接修改被装饰对象方法的方式来完成新功能<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MacBook</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">Macbook.prototype.cost = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="number">997</span>; &#125;;</span><br><span class="line">Macbook.prototype.screenSize = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="number">11.6</span>; &#125;;</span><br><span class="line">   </span><br><span class="line"><span class="comment">// 保存原方法引用，然后定义新的方法替换旧方法</span></span><br><span class="line">_cost = Macbook.prototype.cost;</span><br><span class="line">Macbook.prototype.cost = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> v = _cost.apply(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">return</span> v + <span class="number">75</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mb = <span class="keyword">new</span> Macbook();</span><br><span class="line"><span class="built_in">console</span>.log(mb.cost());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 下面利用AOP的思想完成装饰器模式</span></span><br><span class="line"><span class="comment">// 装饰器函数1</span></span><br><span class="line"><span class="keyword">var</span> before = <span class="function"><span class="keyword">function</span>(<span class="params">fn, beforefn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    beforefn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">return</span> fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 装饰器函数2</span></span><br><span class="line"><span class="keyword">var</span> after = <span class="function"><span class="keyword">function</span>(<span class="params">fn, afterfn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">return</span> afterfn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义原函数</span></span><br><span class="line"><span class="keyword">var</span> count = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第一次装饰后，修改原函数变量引用</span></span><br><span class="line"><span class="keyword">var</span> count = before(count, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 第二次装饰后，修改原函数变量引用</span></span><br><span class="line"><span class="keyword">var</span> count = after(count, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">count(); <span class="comment">// 1 \n 2 \n 3</span></span><br></pre></td></tr></table></figure></p>
<h3 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h3><p>代理模式是为一个对象提供一个代用品或者占位符，以便控制对它的访问。用户实际上访问的是代理对象，代理对象对请求做出一些处理后，再把请求转交给本地对象。</p>
<p>代理分类：</p>
<ol>
<li>保护代理：代理在接受请求后，会根据某些规则过滤掉一些请求不转发给本体对象</li>
<li>虚拟代理：虚拟代理把一些开销很大的对象，延迟到真正需要的时候才去创建</li>
</ol>
<p>代理模式的特点：</p>
<ol>
<li>用户不需要了解代理对象与本体对象的区别，代理对用户来说是透明的</li>
<li>在任何使用本体对象的地方都可以替换成使用代理对象</li>
</ol>
<p>使用代理模式实现图片预加载<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyImage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> imageNode = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(imageNode);</span><br><span class="line">  <span class="keyword">this</span>.image = imageNode;</span><br><span class="line">&#125; </span><br><span class="line">MyImage.prototype.setSrc = <span class="function"><span class="keyword">function</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.image.src = src;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ImageProxy</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.myImage = <span class="keyword">new</span> MyImage();</span><br><span class="line">&#125;</span><br><span class="line">ImageProxy.prototype.setSrc = <span class="function"><span class="keyword">function</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.myImage.setSrc(<span class="string">'loading.png'</span>); <span class="comment">// 设置loading图片</span></span><br><span class="line">  <span class="keyword">var</span> loadImage = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</span><br><span class="line">  loadImage.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.myImage.setSrc(src);</span><br><span class="line">  &#125;</span><br><span class="line">  loadImage.src = src;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接使用</span></span><br><span class="line"><span class="keyword">var</span> image = <span class="keyword">new</span> MyImage();</span><br><span class="line">image.setSrc(src);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用代理</span></span><br><span class="line"><span class="keyword">var</span> imageProxy = <span class="keyword">new</span> ImageProxy();</span><br><span class="line">imageProxy.setSrc(src);</span><br></pre></td></tr></table></figure></p>
<p>上面的例子中，如果只是为了完成预加载的效果，可以把预加载的逻辑直接写在MyImage类中，使用代理是为了让类的职责更加单一和分明</p>
<p><strong>使用代理的意义</strong>：类的单一职责原则。如果一个对象（类）承担了多项责任，就意味着这个对象（类）将变得非常巨大，引起它变化的原因会增多，这会导致这个对象（类）变得不稳定，可能经常需要修改。</p>
<p>创建代理时需要注意代理对象与本地对象接口的一致性，像上述例子，代理与本体的接口都是setSrc，如此用户便无需了解代理与本体的区别。有需求变化的时候直接替换代理对象即可。</p>
<p><strong>代理模式和装饰器模式的区别</strong>：装饰器模式中有一种实现方式也出现了代理对象，可认为是代理模式。但是从根本上，这两种模式的目的是不一致的，代理模式是为了控制对本体对象的访问，装饰器模式是为了向本体对象添加新功能。</p>
<h3 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h3><p>组合模式将对象组合成树形结构，以表示“部分-整体”的层次结构，通过对象的多态性表现，使得用户对单个对象和组合对象的使用具有<strong>一致性</strong>。<br><img src="/img/post/post7/composite_pattern.png" alt="组合模式"><br>在组合模式中，一个组合对象接受到的请求会按照一定的规则向下传递，直到一个叶对象处理这个请求。</p>
<p>使用组合模式模拟文件与文件夹系统<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">File</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line">File.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'文件下无法添加子文件'</span>);</span><br><span class="line">&#125;</span><br><span class="line">File.prototype.scan = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'扫描文件：'</span> + <span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Folder</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.files = &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line">Folder.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.files[file.name] = file;</span><br><span class="line">&#125;</span><br><span class="line">Folder.prototype.scan = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'扫描文件夹：'</span> + <span class="keyword">this</span>.name);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> <span class="keyword">this</span>.files)&#123;</span><br><span class="line">    <span class="keyword">this</span>.files[key].scan();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">var</span> fileA = <span class="keyword">new</span> File(<span class="string">'疯狂的石头.mp4'</span>);</span><br><span class="line"><span class="keyword">var</span> fileB = <span class="keyword">new</span> File(<span class="string">'疯狂的外星人.mp4'</span>);</span><br><span class="line"><span class="keyword">var</span> folderA = <span class="keyword">new</span> Folder(<span class="string">'疯狂系列'</span>);</span><br><span class="line">folderA.add(fileA);</span><br><span class="line">folderA.add(fileB);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fileC = <span class="keyword">new</span> File(<span class="string">'护戒使者.mp4'</span>);</span><br><span class="line"><span class="keyword">var</span> fileD = <span class="keyword">new</span> File(<span class="string">'双塔奇兵.mp4'</span>);</span><br><span class="line"><span class="keyword">var</span> fileE = <span class="keyword">new</span> File(<span class="string">'王者归来.mp4'</span>);</span><br><span class="line"><span class="keyword">var</span> folderB = <span class="keyword">new</span> Folder(<span class="string">'指环王系列'</span>);</span><br><span class="line">folderB.add(fileC);</span><br><span class="line">folderB.add(fileD);</span><br><span class="line">folderB.add(fileE); </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> folderC = <span class="keyword">new</span> Folder(<span class="string">'电影'</span>);</span><br><span class="line">folderC.add(folderA);</span><br><span class="line">folderC.add(folderB);</span><br><span class="line"></span><br><span class="line">folderC.scan();</span><br><span class="line"><span class="comment">// 扫描文件夹：电影</span></span><br><span class="line"><span class="comment">// 扫描文件夹：疯狂系列</span></span><br><span class="line"><span class="comment">// 扫描文件：疯狂的石头.mp4</span></span><br><span class="line"><span class="comment">// 扫描文件：疯狂的外星人.mp4</span></span><br><span class="line"><span class="comment">// 扫描文件夹：指环王系列</span></span><br><span class="line"><span class="comment">// 扫描文件：护戒使者.mp4</span></span><br><span class="line"><span class="comment">// 扫描文件：双塔奇兵.mp4</span></span><br><span class="line"><span class="comment">// 扫描文件：王者归来.mp4</span></span><br></pre></td></tr></table></figure></p>
<p>组合模式中要求组合对象与叶对象，叶对象之间都拥有相同的接口，这使得它们面向用户时有一致性。上述示例中就是文件夹与文件都有scan这个接口，但是文件夹的scan把请求委托给文件继续进行。</p>
<h2 id="行为型设计模式（Behavioral）"><a href="#行为型设计模式（Behavioral）" class="headerlink" title="行为型设计模式（Behavioral）"></a>行为型设计模式（Behavioral）</h2><p>Behavioral pattern focus on improving or streamlining the communication between disparate objects in a system.<br>行为型设计模式关注于提高系统内相互独立的对象之间的交流通讯</p>
<h3 id="观察者模式（Observe）"><a href="#观察者模式（Observe）" class="headerlink" title="观察者模式（Observe）"></a>观察者模式（Observe）</h3><p>The Observer is a design paern where an object (known as a subject) maintains a list of objects depending on it (observers), automatically notifying them of any changes to state.<br>观察者模式中存在两种关键对象以及三种关键操作</p>
<ol>
<li>subject对象：维护一系列的观察者对象，提供三种基本操作方式：被订阅（注册监听方法 register），被取消订阅（移除监听方法 remove），触发事件（trigger）。</li>
<li>observers对象：业务逻辑执行对象，监听subject对象触发的事件。</li>
</ol>
<p>观察者模式非常有利于对象之间的解耦<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Subject</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> Subject)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Subject();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.observerList = [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Subject.prototype.register = <span class="function"><span class="keyword">function</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!observer || !observer.update) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.observerList.push(observer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Subject.prototype.remove = <span class="function"><span class="keyword">function</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> index = <span class="keyword">this</span>.observerList.indexOf(observer);</span><br><span class="line">  <span class="keyword">this</span>.observerList.splice(index, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Subject.prototype.notify = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.observerList.forEach(<span class="function"><span class="params">observer</span> =&gt;</span> &#123;</span><br><span class="line">    observer.update &amp;&amp; observer.update()</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Observer</span>(<span class="params">updatefn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.update = updatefn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">var</span> ob1 = <span class="keyword">new</span> Observer(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'ob1 udpate'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ob2 = <span class="keyword">new</span> Observer(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'ob2 update'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> subject = <span class="keyword">new</span> Subject();</span><br><span class="line">subject.register(ob1);</span><br><span class="line">subject.register(ob2);</span><br><span class="line"></span><br><span class="line">subject.notify();</span><br></pre></td></tr></table></figure></p>
<h4 id="发布订阅模式（Publish-Subscribe）"><a href="#发布订阅模式（Publish-Subscribe）" class="headerlink" title="发布订阅模式（Publish/Subscribe）"></a>发布订阅模式（Publish/Subscribe）</h4><p>比起观察者模式，js中更常见的是发布订阅模式，发布订阅模式是观察者模式的一个变种，它们之前的不同在于，观察者模式没有自定义事件，当subject对象发出更新通知，所有的observer都需要做出响应，而发布订阅模式实际上是一个自定义的事件系统，通过不同的事件订阅来区分不同的observer。<br>发布订阅者模式的两种对象和三个关键方法</p>
<ol>
<li>publisher：维护一系列的subscriber对象，提供三种基本操作方式：被订阅（注册监听方法 subscribe(event, handler)），被取消订阅（移除监听方法 unsubscribe(event, handler)），触发事件（publish(event)）。</li>
<li>subscribers：相当于原来的observer对象，通过监听事件进行业务处理</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Publisher</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.eventSet = &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line">Publisher.prototype.subscribe = <span class="function"><span class="keyword">function</span>(<span class="params">event, subscriber</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!subscriber || !subscriber.update) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.eventSet[event]) &#123;</span><br><span class="line">    <span class="keyword">this</span>.eventSet[event] = [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.eventSet[event].push(subscriber);</span><br><span class="line">&#125;</span><br><span class="line">Publisher.prototype.unsubscribe = <span class="function"><span class="keyword">function</span>(<span class="params">event, subscriber</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!event || !<span class="keyword">this</span>.eventSet[event]) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!subscriber) &#123;</span><br><span class="line">    <span class="keyword">this</span>.eventSet[event] = [];</span><br><span class="line">    <span class="keyword">delete</span> <span class="keyword">this</span>.eventSet[event];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> subscribers = <span class="keyword">this</span>.eventSet[eventSet];</span><br><span class="line">    <span class="keyword">var</span> index = subscribers.indexOf(subscriber);</span><br><span class="line">    subscribers.splice(index, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">Publisher.prototype.publish = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!event || !<span class="keyword">this</span>.eventSet[event]) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> subscribers = <span class="keyword">this</span>.eventSet[event];</span><br><span class="line">  subscribers.forEach(<span class="function"><span class="params">subscriber</span> =&gt;</span> &#123;</span><br><span class="line">    subscriber.update &amp;&amp; subscriber.update();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Subscriber</span>(<span class="params">updatefn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.update = updatefn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试用例</span></span><br><span class="line"><span class="keyword">var</span> sb1 = <span class="keyword">new</span> Subscriber(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'sb1 update'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> sb2 = <span class="keyword">new</span> Subscriber(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'sb2 update'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> publisher = <span class="keyword">new</span> Publisher();</span><br><span class="line">publisher.subscribe(<span class="string">'js'</span>, sb1);</span><br><span class="line">publisher.subscribe(<span class="string">'java'</span>, sb2);</span><br><span class="line"></span><br><span class="line">publisher.publish(<span class="string">'js'</span>);</span><br><span class="line">publisher.publish(<span class="string">'java'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h3><p>If it appears a system has too many direct relationships between components, it may be time to have a central point of control that components communicate through instead. The Mediator promotes loose coupling by ensuring that instead of components referring to each other explicitly, their interaction is handled through this central point. This can help us decouple systems and improve the potential for component reusability.<br>如果一个系统内有大量的组件之间存在直接关联（通常表现为相互持有引用），此时应该设置一个中央节点来控制组件之间的联系。这个中央节点既能保持组件之间的联系（组件之间任然能通信），又能让组件之间充分解耦（让组件不再相互持有引用）。这就是中介者模式，中央节点就是中介者。<br>真实世界中 机场控制系统就是典型的中介者模式，机场控制系统接管了所有的通信和业务处理，而不是把通信留给飞机和飞机之间。集中化控制是这个系统的特点，机场控制系统就是其中中介者的角色</p>
<p>使用中介者模式来模拟游戏<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用中介者模式完成游戏设计</span></span><br><span class="line"><span class="comment">// 游戏规则，玩家分成红蓝两队，某一队的所有玩家都死亡后，另一队所有玩家获胜</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义玩家</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Player</span>(<span class="params">name, team</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.team = team;</span><br><span class="line">  <span class="keyword">this</span>.state = Player.STATE.alive;</span><br><span class="line">&#125;</span><br><span class="line">Player.prototype.win = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">' win'</span>);</span><br><span class="line">&#125;</span><br><span class="line">Player.prototype.lose = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">' lose'</span>);</span><br><span class="line">&#125;</span><br><span class="line">Player.prototype.die = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.state = Player.STATE.die;</span><br><span class="line">  <span class="keyword">this</span>.lose();</span><br><span class="line">  <span class="comment">// 每一位玩家只与中介者发生联系</span></span><br><span class="line">  GameCenter.publish(<span class="string">'playerDead'</span>, <span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line">Player.TEAM = &#123;</span><br><span class="line">  red: <span class="string">'red'</span>,</span><br><span class="line">  blue: <span class="string">'blue'</span></span><br><span class="line">&#125;</span><br><span class="line">Player.STATE = &#123;</span><br><span class="line">  alive: <span class="string">'alive'</span>,</span><br><span class="line">  die: <span class="string">'die'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义游戏中心，中介者</span></span><br><span class="line"><span class="keyword">var</span> GameCenter = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> teams = &#123;</span><br><span class="line">    [Player.TEAM.red]: [],</span><br><span class="line">    [Player.TEAM.blue]: [],</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> operations = &#123;</span><br><span class="line">    playerDead: <span class="function"><span class="keyword">function</span>(<span class="params">player</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (player &amp;&amp; player.team &amp;&amp; teams[player.team]) &#123;</span><br><span class="line">        <span class="keyword">var</span> players = teams[player.team];</span><br><span class="line">        <span class="keyword">if</span> (!players.some(<span class="function"><span class="params">player</span> =&gt;</span> player.state === Player.STATE.alive)) &#123;</span><br><span class="line">          <span class="keyword">var</span> winPlayers = player.team === Player.TEAM.red ? teams[Player.TEAM.blue] : teams[Player.TEAM.red];</span><br><span class="line">          winPlayers.forEach(<span class="function"><span class="params">player</span> =&gt;</span> player.win());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    addPlayer: <span class="function"><span class="keyword">function</span>(<span class="params">player</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (player &amp;&amp; player.team &amp;&amp; teams[player.team]) &#123;</span><br><span class="line">        teams[player.team].push(player);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    publish: <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">      params = <span class="built_in">Array</span>.prototype.splice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line">      <span class="comment">// 由中介者处理玩家之间的联系</span></span><br><span class="line">      operations[event] &amp;&amp; operations[event].apply(<span class="keyword">this</span>, params);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义玩家生成工厂</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">playerFactory</span>(<span class="params">name, team</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> player = <span class="keyword">new</span> Player(name, team);</span><br><span class="line">  GameCenter.publish(<span class="string">'addPlayer'</span>, player);</span><br><span class="line">  <span class="keyword">return</span> player;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试用例</span></span><br><span class="line"><span class="keyword">var</span> xiaoming = playerFactory(<span class="string">'xiaoming'</span>, Player.TEAM.red);</span><br><span class="line"><span class="keyword">var</span> xiaohong = playerFactory(<span class="string">'xiaohong'</span>, Player.TEAM.red);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xiaoqiao = playerFactory(<span class="string">'xiaoqiao'</span>, Player.TEAM.blue);</span><br><span class="line"><span class="keyword">var</span> xiaobing = playerFactory(<span class="string">'xiaobing'</span>, Player.TEAM.blue);</span><br><span class="line"></span><br><span class="line">xiaoming.die(); <span class="comment">// xiaoming lose</span></span><br><span class="line">xiaohong.die(); <span class="comment">// xiaohong lose</span></span><br><span class="line"><span class="comment">// xiaoqiao win</span></span><br><span class="line"><span class="comment">// xiaobing win</span></span><br></pre></td></tr></table></figure></p>
<p>通过以上例子可以发现，中介者模式通常伴随着观察者模式（发布订阅者模式），这两种模式的区别在于：</p>
<ol>
<li>观察者（事件）模式基于事件系统让不同的对象进行通信，目的在于让系统耦合松散。而中介者模式使用一个中介者对象进行业务逻辑处理，其余对象都与中介者通信，通信的手段通常使用事件系统，然而不一定就只用事件系统。所以可以说中介者模式通常使用了观察者模式作为通信手段。</li>
<li>关于第三方对象：观察者（事件）模式中，publisher or subject 是一个第三方对象，他们的作用在于提供事件总线来传递事件。而中介者模式中，中介者是第三方对象，它的职责在于处理业务逻辑，保持其余对象之间的联系，为其余对象解耦</li>
</ol>
<h3 id="状态模式（state）"><a href="#状态模式（state）" class="headerlink" title="状态模式（state）"></a>状态模式（state）</h3><p>GoF对状态模式的定义：允许一个对象在内部状态改变的时候改变它的行为，对象看起来似乎修改了它的类。这句话可以分为两部分理解：1、需要将状态封装成独立的类，并且将请求委托给状态类处理，这样可以实现当对象内部状态改变时，有不同的行为变化。2、从用户的角度看，一个对象在状态不同的情况下有截然不同的行为，实际上是将请求委托给状态类对象处理产生的结果。</p>
<p>状态模式的结构通常有两个重要角色：</p>
<ol>
<li>上下文对象（Context）：上下文对象是面向用户的对象，也是持有状态并且在不同状态下表现出不同行为的对象。上下文对象需要持有状态对象的引用，以便将请求委托给状态类对象处理</li>
<li>状态类对象（State）：状态类对象代表某一种状态以及这种状态下需要处理的业务逻辑和状态切换。</li>
</ol>
<p>下面使用状态模式编写一个可以在强光 - 弱光 - 关灯 三个状态之间切换的台灯。状态切换逻辑如下图所示：<br><img src="/img/post/post7/state_pattern.png" alt="台灯状态切换"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">StrongLightState</span>(<span class="params">lamp</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.lamp = lamp;</span><br><span class="line">&#125;</span><br><span class="line">StrongLightState.prototype.nextState = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'关闭台灯'</span>);</span><br><span class="line">  <span class="keyword">this</span>.lamp.setState(<span class="keyword">this</span>.lamp.offLightState);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">WeakLightState</span>(<span class="params">lamp</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.lamp = lamp;</span><br><span class="line">&#125;</span><br><span class="line">WeakLightState.prototype.nextState = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'打开强光'</span>);</span><br><span class="line">  <span class="keyword">this</span>.lamp.setState(<span class="keyword">this</span>.lamp.strongLightState);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">OffLightState</span>(<span class="params">lamp</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.lamp = lamp;</span><br><span class="line">&#125;</span><br><span class="line">OffLightState.prototype.nextState = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'打开弱光'</span>);</span><br><span class="line">  <span class="keyword">this</span>.lamp.setState(<span class="keyword">this</span>.lamp.weakLightState);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Lamp</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.strongLightState = <span class="keyword">new</span> StrongLightState(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">this</span>.weakLightState = <span class="keyword">new</span> WeakLightState(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">this</span>.offLightState = <span class="keyword">new</span> OffLightState(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.state = <span class="keyword">this</span>.offLightState;</span><br><span class="line">&#125;</span><br><span class="line">Lamp.prototype.pressButton = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.state.nextState();</span><br><span class="line">&#125;</span><br><span class="line">Lamp.prototype.setState = <span class="function"><span class="keyword">function</span>(<span class="params">state</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.state = state;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">var</span> lamp = <span class="keyword">new</span> Lamp();</span><br><span class="line">lamp.pressButton(); <span class="comment">// 打开弱光</span></span><br><span class="line">lamp.pressButton(); <span class="comment">// 打开强光</span></span><br><span class="line">lamp.pressButton(); <span class="comment">// 关闭台灯</span></span><br></pre></td></tr></table></figure>
<p>状态模式的优点：</p>
<ol>
<li>使用状态类将当前状态以及当前状态的行为封装起来，通过新增状态类，可以容易的在状态机中新加状态。</li>
<li>避免了在context对象中书写冗长的状态判断逻辑，使得context对象更加稳定。</li>
</ol>
<p>缺点：</p>
<ol>
<li>状态之间的切换散布在各个状态类之间，无法对所有状态之间的切换逻辑一目了然。（需要用整体设计图弥补）</li>
<li>可能会产生数量庞大的状态类对象（可以用享元模式优化内存）</li>
</ol>
<h3 id="策略模式（strategy）"><a href="#策略模式（strategy）" class="headerlink" title="策略模式（strategy）"></a>策略模式（strategy）</h3><p>策略模式：定义一系列的算法，把它们封装起来，使得在不同条件下可以调用不同的算法。<br>策略模式至少由两部分组成：</p>
<ol>
<li>上下文（Context）：Context面向用户，接受用户请求，并将用户请求委托给策略类进行处理。</li>
<li>策略类（strategy）：算法封装类，向Context提供不同类型的算法。</li>
</ol>
<p>下面使用策略模式实现表单校验功能<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// context对象，接受用户校验请求，然后委托给策略对象处理</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Validator</span>(<span class="params">strategy</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.strategy = strategy;</span><br><span class="line">  <span class="keyword">this</span>.rules = [];</span><br><span class="line">&#125;</span><br><span class="line">Validator.prototype.addRule = <span class="function"><span class="keyword">function</span>(<span class="params">value, strategyName, errorMsg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.rules.push(&#123;</span><br><span class="line">    strategyName: strategyName,</span><br><span class="line">    value: value,</span><br><span class="line">    errorMsg: errorMsg,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">Validator.prototype.start = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> errorMsg;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, rule; i &lt; <span class="keyword">this</span>.rules.length; i++ ) &#123;</span><br><span class="line">    rule = <span class="keyword">this</span>.rules[i];</span><br><span class="line">    errorMsg = <span class="keyword">this</span>.strategy[rule.strategyName] &amp;&amp; <span class="keyword">this</span>.strategy[rule.strategyName](rule.value, rule.errorMsg);</span><br><span class="line">    <span class="keyword">if</span> (errorMsg) &#123;</span><br><span class="line">      <span class="keyword">return</span> errorMsg;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试用例</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">formData, validator</span>) </span>&#123;</span><br><span class="line">  validator.addRule(formData.name, <span class="string">'notEmpty'</span>, <span class="string">'姓名不能为空'</span>);</span><br><span class="line">  validator.addRule(formData.phone, <span class="string">'notEmpty'</span>, <span class="string">'手机号不能为空'</span>);</span><br><span class="line">  validator.addRule(formData.phone, <span class="string">'phone'</span>, <span class="string">'需要填入正确的手机号'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> errorMsg = validator.start();</span><br><span class="line">  <span class="keyword">if</span> (errorMsg) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(errorMsg);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'校验通过'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test(&#123;</span><br><span class="line">  name: <span class="string">'xiaoming'</span>,</span><br><span class="line">  phone: <span class="string">'13525220867'</span></span><br><span class="line">&#125;, <span class="keyword">new</span> Validator(strategy));</span><br><span class="line"><span class="comment">// 检验通过</span></span><br><span class="line"></span><br><span class="line">test(&#123;</span><br><span class="line">  name: <span class="string">''</span>,</span><br><span class="line">  phone: <span class="string">'13525220867'</span></span><br><span class="line">&#125;, <span class="keyword">new</span> Validator(strategy));</span><br><span class="line"><span class="comment">// 姓名不能为空</span></span><br><span class="line"></span><br><span class="line">test(&#123;</span><br><span class="line">  name: <span class="string">'xiaoming'</span>,</span><br><span class="line">  phone: <span class="string">''</span></span><br><span class="line">&#125;, <span class="keyword">new</span> Validator(strategy));</span><br><span class="line"><span class="comment">// 手机号不能为空</span></span><br></pre></td></tr></table></figure></p>
<p>策略模式与状态模式的相同点：</p>
<ol>
<li>都有context对象来接受用户请求，并且context对象都把请求委托给状态类对象or策略类对象来处理。</li>
<li>这两种模式本质上都是利用context对象作为代理，将面向用户的对象和具体的业务执行逻辑进行拆分解耦。</li>
</ol>
<p>不同点：</p>
<ol>
<li>策略模式中，各种策略之间是平等平行的，没有联系。状态模式中状态类一般会封装好状态和状态对应的行为这两样东西，不同状态之间往往存在切换，并且状态切换这个事情发生在状态模式内部。</li>
</ol>
<h3 id="职责链模式（Chain-of-Responsibility）"><a href="#职责链模式（Chain-of-Responsibility）" class="headerlink" title="职责链模式（Chain of  Responsibility）"></a>职责链模式（Chain of  Responsibility）</h3><p>职责链模式：多个对象组成一条链，让请求在这条链中传递，直到有一个对象处理它为止。<br><img src="/img/post/post7/responsibility_chain.png" alt="职责链模式"></p>
<p>使用职责链模式模拟用户订单处理<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订单类型</span></span><br><span class="line"><span class="keyword">var</span> ORDER_TYPE = &#123;</span><br><span class="line">  vip: <span class="number">1</span>, <span class="comment">// vip订单</span></span><br><span class="line">  priority: <span class="number">2</span>, <span class="comment">// 优先订单</span></span><br><span class="line">  normal: <span class="number">3</span>, <span class="comment">// 普通订单</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stock = <span class="number">12</span>; <span class="comment">// 库存</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义订单处理函数，返回true表示处理成功，false表示处理失败。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handlerVip</span>(<span class="params">orderType</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (orderType === ORDER_TYPE.vip &amp;&amp; stock &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'vip订单：出货'</span>);</span><br><span class="line">    stock--;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handlerPriority</span>(<span class="params">orderType</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (orderType === ORDER_TYPE.priority &amp;&amp; stock &gt; <span class="number">10</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'优先订单：出货'</span>);</span><br><span class="line">    stock--;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handlerNormal</span>(<span class="params">orderType</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (orderType === ORDER_TYPE.normal &amp;&amp; stock &gt; <span class="number">11</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'普通订单：出货'</span>);</span><br><span class="line">    stock--;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'库存不足，出货失败'</span>);</span><br><span class="line">    <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ChainNode</span>(<span class="params">handler</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.handler = handler;</span><br><span class="line">&#125;</span><br><span class="line">ChainNode.prototype.setNextHandler = <span class="function"><span class="keyword">function</span>(<span class="params">nextHandler</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.nextHandler = nextHandler;</span><br><span class="line">&#125;</span><br><span class="line">ChainNode.prototype.passRequest = <span class="function"><span class="keyword">function</span>(<span class="params">orderType</span>) </span>&#123;</span><br><span class="line">!<span class="keyword">this</span>.handler(orderType) &amp;&amp; <span class="keyword">this</span>.nextHandler &amp;&amp; <span class="keyword">this</span>.nextHandler.passRequest(orderType);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试用例</span></span><br><span class="line"><span class="keyword">var</span> vipNode = <span class="keyword">new</span> ChainNode(handlerVip);</span><br><span class="line"><span class="keyword">var</span> priorityNode = <span class="keyword">new</span> ChainNode(handlerPriority);</span><br><span class="line"><span class="keyword">var</span> normalNode = <span class="keyword">new</span> ChainNode(handlerNormal);</span><br><span class="line"></span><br><span class="line">vipNode.setNextHandler(priorityNode);</span><br><span class="line">priorityNode.setNextHandler(normalNode);</span><br><span class="line"></span><br><span class="line">vipNode.passRequest(ORDER_TYPE.normal);</span><br><span class="line">vipNode.passRequest(ORDER_TYPE.priority);</span><br><span class="line">vipNode.passRequest(ORDER_TYPE.vip);</span><br><span class="line">vipNode.passRequest(ORDER_TYPE.normal);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通订单：出货</span></span><br><span class="line"><span class="comment">// 优先订单：出货</span></span><br><span class="line"><span class="comment">// vip订单：出货</span></span><br><span class="line"><span class="comment">// 库存不足，出货失败</span></span><br></pre></td></tr></table></figure></p>
<p>职责链可以将对一个对象的多个不同处理很好的解耦开来，并且职责链节点可以重组方便修改可拓展逻辑。职责链的模式应用非常广，express等node后台框架的中间件设计就是应用了职责链模式。<br>如果职责链节点中包含了异步处理，那么处理函数中返回一个promise对象即可，职责链节点需要等待这个promise对象resolve或者reject之后，判断是否需要将请求传递给下一个节点。<br>职责链模式中有两个比较明显的缺点</p>
<ol>
<li>往往需要注意节点之间的顺序来形成正确的处理流程</li>
<li>当链条过长，请求在节点之间传递会造成性能损耗</li>
</ol>
<h1 id="后话"><a href="#后话" class="headerlink" title="后话"></a>后话</h1><p>本文总结了23中设计模式中的14种，里面的代码示例主要来源于《Learning JavaScript Design pattern》和《javascript设计模式与开发实践》这两本书。剩下的一些未总结的设计模式要么是这两本书内未提到的（毕竟不是所有设计模式在js中都适用），要么是自己觉得对这种模式还不够理解，不敢妄加评论。</p>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2019/02/14/mvc-mvp-mvvm模式总结/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2019/02/11/js构造函数与继承/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/random/material-13.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/touxiang.jpg" alt="aasailan's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        joeaasailan@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto:joeaasailan@gmail.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2019/02/">二月 2019<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/07/">七月 2018<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/06/">六月 2018<span class="sidebar_archives-count">3</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/cordova系列/">cordova系列<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/css系列/">css系列<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/docker/">docker<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/hexo/">hexo<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/js/">js<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/翻译系列/">翻译系列<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/tags" title="标签云">
                
                标签云
            </a>
        </li>
        
    
        <li>
            <a href="/timeline" title="时间轴">
                
                时间轴
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">8</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/aasailan" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;2018&nbsp;-<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>aasailan的blog
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?wgjW/HuQG9JDgvPDPoRAng==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?d+XW6aNuIPgOn1iA7NnB4g==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>



    
        <script>lsloader.load("sm_js","/js/smoothscroll.js?tNQK2Tw2SUL8a1Scn/Mgew==", true)</script>
    











<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->


    
        <script>lsloader.load("hanabi","/js/hanabi-browser-bundle.js?5+2z7ZZmFuZK5IcimlZbxw==", true)</script>
    


<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
    
        
        
        HanabiBrowser.start('pre code',true);
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.2 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
            <script type="text/javascript" color="112,255,59" opacity='1' zIndex="0" count="99" src="https://cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script>
        </body>
    
</html>
